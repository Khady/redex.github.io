// Generated by BUCKLESCRIPT VERSION 2.1.0, PLEASE EDIT WITH CARE
'use strict';

var Icon                   = require("../vendor/icons/Icon.js");
var $$Array                = require("bs-platform/lib/js/array.js");
var Block                  = require("bs-platform/lib/js/block.js");
var Curry                  = require("bs-platform/lib/js/curry.js");
var React                  = require("react");
var ReasonReact            = require("reason-react/src/ReasonReact.js");
var Algoliasearch          = require("algoliasearch");
var PackageSummary         = require("./PackageSummary.js");
var AlgoliasearchHelper    = require("algoliasearch-helper");
var PackageSearchBoxStyles = require("./PackageSearchBoxStyles.js");

var appId = "B1AVN0IGTU";

var apiKey = "c7a3475a8567971cb7510b422d9f37ad";

var index = "re:libs";

function decodeResult(json) {
  return Object.assign({
              slug: "/packages/" + json.id
            }, json);
}

var component = ReasonReact.reducerComponent("PackageSearchBox");

function make() {
  var newrecord = component.slice();
  newrecord[/* didMount */4] = (function (param) {
      var reduce = param[/* reduce */1];
      param[/* state */2][/* searchClient */0].on("result", (function (results, _) {
              return Curry._2(reduce, (function () {
                            return /* ResultsChanged */Block.__(1, [results.hits]);
                          }), /* () */0);
            }));
      return /* NoUpdate */0;
    });
  newrecord[/* render */9] = (function (param) {
      var state = param[/* state */2];
      var match = state[/* results */1].length;
      return React.createElement("div", {
                  className: PackageSearchBoxStyles.root
                }, React.createElement("div", {
                      className: PackageSearchBoxStyles.fakeInput
                    }, ReasonReact.element(/* None */0, /* None */0, Icon.Search[/* make */0](/* Some */[PackageSearchBoxStyles.searchIcon], /* array */[])), React.createElement("input", {
                          className: PackageSearchBoxStyles.input,
                          placeholder: "Search packages",
                          onChange: Curry._1(param[/* reduce */1], (function (e) {
                                  return /* QueryChanged */Block.__(0, [e.target.value]);
                                }))
                        })), match !== 0 ? React.createElement("div", {
                        className: PackageSearchBoxStyles.results
                      }, $$Array.map((function ($$package) {
                              return ReasonReact.element(/* None */0, /* None */0, PackageSummary.make($$package, /* array */[]));
                            }), $$Array.map(decodeResult, state[/* results */1]))) : null);
    });
  newrecord[/* initialState */10] = (function () {
      return /* record */[
              /* searchClient */AlgoliasearchHelper(Algoliasearch(appId, apiKey), index),
              /* results : array */[]
            ];
    });
  newrecord[/* reducer */12] = (function (action, state) {
      if (action.tag) {
        var results = action[0];
        console.log(results.length);
        return /* Update */Block.__(0, [/* record */[
                    /* searchClient */state[/* searchClient */0],
                    /* results */results
                  ]]);
      } else {
        var query = action[0];
        if (query === "") {
          return /* Update */Block.__(0, [/* record */[
                      /* searchClient */state[/* searchClient */0],
                      /* results : array */[]
                    ]]);
        } else {
          return /* SideEffects */Block.__(2, [(function (param) {
                        param[/* state */2][/* searchClient */0].setQuery(query).search();
                        return /* () */0;
                      })]);
        }
      }
    });
  return newrecord;
}

var $$default = ReasonReact.wrapReasonForJs(component, (function () {
        return make(/* array */[]);
      }));

var Styles = 0;

exports.Styles       = Styles;
exports.appId        = appId;
exports.apiKey       = apiKey;
exports.index        = index;
exports.decodeResult = decodeResult;
exports.component    = component;
exports.make         = make;
exports.$$default    = $$default;
exports.default      = $$default;
exports.__esModule   = true;
/* component Not a pure module */
